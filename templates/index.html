{% extends 'base.html' %}
{% block content %}
<div class="w3-row-padding">
    <!-- LEFT SIDE FORM -->
    <div class="w3-third">
        <div class="w3-card-4 w3-container w3-padding">
            <fieldset>
                <legend><b>STUDENT INFORMATION</b></legend>

                {% if messages %}
                    {% for message in messages %}
                        <div style="padding:10px; margin-bottom:10px; 
                                    border:1px solid #ccc; 
                                    background-color:#dff0d8; color:#3c763d;">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}

                {% set profile_image = student_to_edit['image'] if student_to_edit and student_to_edit['image'] else 'default.png' %}

                <form id="studentForm" method="POST" 
                      action="{{ url_for('add_student') }}" 
                      enctype="multipart/form-data">
                <center>
                    <div style="text-align:center; position: relative; margin-bottom:10px;">
                        <img src="{{ url_for('static', filename='images/' + (student_to_edit['image'] if student_to_edit and student_to_edit['image'] else 'default.png')) }}"
                            alt="Profile" width="100" height="100"
                            id="studentImage" class="student-img" style="border-radius: 50%; object-fit: cover; width: 100px; height: 100px; cursor: pointer;">

                        <p style="font-size: 12px; color: #555; margin-top: 5px;">Click image to upload photo</p>
                    </div>
                </center>

                <input type="file" id="imagePicker" name="image" style="display:none;" accept="image/*">
                
                    <p style="text-align: left;">
                        <label><b>IDNO</b></label>
                        <input type="number" name="idno" id="idno" class="w3-input w3-border" value="{{ student_to_edit['idno'] if student_to_edit else '' }}">
                    </p>
                    <p style="text-align: left;">
                        <label><b>LASTNAME</b></label>
                        <input type="text" name="lastname" id="lastname" class="w3-input w3-border" value="{{ student_to_edit['lastname'] if student_to_edit else '' }}">
                    </p>
                    <p style="text-align: left;">
                        <label><b>FIRSTNAME</b></label>
                        <input type="text" name="firstname" id="firstname" class="w3-input w3-border" value="{{ student_to_edit['firstname'] if student_to_edit else '' }}">
                    </p>
                    <p style="text-align: left;">
                        <label><b>COURSE</b></label>
                        <select name="course" id="course" class="w3-input w3-border">
                            <option value='bsit' {% if student_to_edit and student_to_edit['course']=='bsit' %}selected{% endif %}>INFORMATION TECHNOLOGY</option>
                            <option value='bscs' {% if student_to_edit and student_to_edit['course']=='bscs' %}selected{% endif %}>COMPUTER SCIENCE</option>
                            <option value='bscpe' {% if student_to_edit and student_to_edit['course']=='bscpe' %}selected{% endif %}>COMPUTER ENGINEERING</option>
                            <option value='bshm' {% if student_to_edit and student_to_edit['course']=='bshm' %}selected{% endif %}>HOSPITALITY MANAGEMENT</option>
                            <option value='bscj' {% if student_to_edit and student_to_edit['course']=='bscj' %}selected{% endif %}>CRIMINAL JUSTICE</option>
                        </select>
                    </p>
                    <p style="text-align: left;">
                        <label><b>LEVEL</b></label>
                        <select name="level" id="level" class="w3-input w3-border">
                            <option value='1' {% if student_to_edit and student_to_edit['level']=='1' %}selected{% endif %}>FIRST YEAR</option>
                            <option value='2' {% if student_to_edit and student_to_edit['level']=='2' %}selected{% endif %}>SECOND YEAR</option>
                            <option value='3' {% if student_to_edit and student_to_edit['level']=='3' %}selected{% endif %}>THIRD YEAR</option>
                            <option value='4' {% if student_to_edit and student_to_edit['level']=='4' %}selected{% endif %}>FOURTH YEAR</option>
                        </select>
                    </p>

                    <p class="w3-right">
                        <input type="submit" id="submitBtn" value="{% if student_to_edit %}UPDATE{% else %}SAVE{% endif %}" class="w3-button w3-blue">
                        <input type="reset" id="cancelBtn" value="CANCEL" class="w3-button w3-green">
                    </p>
                </form>
            </fieldset>
        </div>
    </div>

 <!-- RIGHT SIDE TABLE -->
<div class="w3-twothird w3-container w3-right">
    {% if studentlist %}
    <table class="w3-table w3-card-4 w3-right">
        <tr>
            <th>IDNO</th>
            <th class="w3-hide-small w3-hide-medium">LASTNAME</th>
            <th class="w3-hide-small w3-hide-medium">FIRSTNAME</th>
            <th class="w3-hide-large">NAME</th>
            <th class="w3-hide-small w3-hide-medium">COURSE</th>
            <th class="w3-hide-small w3-hide-medium">LEVEL</th>
            <th class="w3-hide-large">COURSE & LEVEL</th>
            <th>ACTION</th>
        </tr>

        {% for student in studentlist %}
        <tr>
            <td>{{ student['idno'] }}</td>
            <td class="w3-hide-small w3-hide-medium">{{ student['lastname'].upper() }}</td>
            <td class="w3-hide-small w3-hide-medium">{{ student['firstname'].upper() }}</td>
            <td class="w3-hide-large">{{ student['lastname'].upper() }}, {{ student['firstname'].upper() }}</td>
            <td class="w3-hide-small w3-hide-medium">{{ student['course'].upper() }}</td>
            <td class="w3-hide-small w3-hide-medium">{{ student['level'].upper() }}</td>
            <td class="w3-hide-large">{{ student['course'].upper() }}-{{ student['level'].upper() }}</td>
            <td>
                <a href="#" class="w3-button w3-blue editBtn"
                   data-idno="{{ student['idno'] }}"
                   data-lastname="{{ student['lastname'] }}"
                   data-firstname="{{ student['firstname'] }}"
                   data-course="{{ student['course'] }}"
                   data-level="{{ student['level'] }}"
                   data-image="{{ student['image'] }}">&#128393;</a>

                <a href="{{ url_for('delete_student', idno=student['idno']) }}" class="w3-button w3-red"
                   onclick="return confirm('Are you sure you want to delete this student?')">&#128465;</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>No students found.</p>
    {% endif %}
</div>

</div>

<script src="{{ url_for('static', filename='js/student_form.js') }}"></script>
{% endblock %}
